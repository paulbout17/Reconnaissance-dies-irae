<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ã‰preuve de chant</title>

  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>

  <!-- Teachable Machine Sound -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/sound@latest"></script>
</head>

<body style="text-align:center;font-family:Arial;">

<h1>ğŸ¤ Chante le bon son</h1>

<p>Clique sur le bouton puis chante</p>

<button onclick="init()">ğŸ™ï¸ DÃ©marrer le micro</button>

<p id="debug" style="margin-top:15px;color:#555;">
En attente...
</p>

<p id="resultat" style="font-size:20px;font-weight:bold;margin-top:20px;">
</p>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/f5Yu1VRts/";
let recognizer;

async function init() {
  try {
    document.getElementById("debug").innerHTML =
      "â³ Chargement du modÃ¨le...";

    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    recognizer = await tmSound.create(modelURL, metadataURL);
    await recognizer.ensureModelLoaded();

    document.getElementById("debug").innerHTML =
      "ğŸ§ Micro en Ã©coute... Chante maintenant";

    recognizer.listen(result => {
      const labels = recognizer.wordLabels();
      const scores = result.scores;

      let bestScore = 0;
      let bestLabel = "";

      for (let i = 0; i < scores.length; i++) {
        if (scores[i] > bestScore) {
          bestScore = scores[i];
          bestLabel = labels[i];
        }
      }

      if (bestScore > 0.85) {
        document.getElementById("resultat").innerHTML =
          "âœ… Bravo ! Son reconnu : <b>" + bestLabel + "</b>";
      } else {
        document.getElementById("resultat").innerHTML =
          "âŒ Continue Ã  chanter...";
      }

    }, { probabilityThreshold: 0.75 });

  } catch (error) {
    document.getElementById("debug").innerHTML =
      "âŒ Erreur : " + error.message;
    console.error(error);
  }
}
</script>

</body>
</html>
